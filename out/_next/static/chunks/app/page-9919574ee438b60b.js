(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1661:(e,t,i)=>{Promise.resolve().then(i.bind(i,6036))},6036:(e,t,i)=>{"use strict";i.d(t,{default:()=>W});var l=i(5155),a=i(2115),s=i(2317),r=i(1027),n=i(3463),o=i(9795);function d(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(0,o.QP)((0,n.$)(t))}let c=(0,r.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),f=a.forwardRef((e,t)=>{let{className:i,variant:a,size:r,asChild:n=!1,...o}=e,f=n?s.DX:"button";return(0,l.jsx)(f,{className:d(c({variant:a,size:r,className:i})),ref:t,...o})});f.displayName="Button";let m=a.forwardRef((e,t)=>{let{className:i,type:a,...s}=e;return(0,l.jsx)("input",{type:a,className:d("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",i),ref:t,...s})});m.displayName="Input";var h=i(6195);let u=(0,r.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),x=a.forwardRef((e,t)=>{let{className:i,...a}=e;return(0,l.jsx)(h.b,{ref:t,className:d(u(),i),...a})});x.displayName=h.b.displayName;var p=i(4850),g=i(2645),y=i(2488),b=i(7193);let j=p.bL;p.YJ;let v=p.WT,N=a.forwardRef((e,t)=>{let{className:i,children:a,...s}=e;return(0,l.jsxs)(p.l9,{ref:t,className:d("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",i),...s,children:[a,(0,l.jsx)(p.In,{asChild:!0,children:(0,l.jsx)(g.A,{className:"h-4 w-4 opacity-50"})})]})});N.displayName=p.l9.displayName;let w=a.forwardRef((e,t)=>{let{className:i,...a}=e;return(0,l.jsx)(p.PP,{ref:t,className:d("flex cursor-default items-center justify-center py-1",i),...a,children:(0,l.jsx)(y.A,{className:"h-4 w-4"})})});w.displayName=p.PP.displayName;let S=a.forwardRef((e,t)=>{let{className:i,...a}=e;return(0,l.jsx)(p.wn,{ref:t,className:d("flex cursor-default items-center justify-center py-1",i),...a,children:(0,l.jsx)(g.A,{className:"h-4 w-4"})})});S.displayName=p.wn.displayName;let z=a.forwardRef((e,t)=>{let{className:i,children:a,position:s="popper",...r}=e;return(0,l.jsx)(p.ZL,{children:(0,l.jsxs)(p.UC,{ref:t,className:d("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",i),position:s,...r,children:[(0,l.jsx)(w,{}),(0,l.jsx)(p.LM,{className:d("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,l.jsx)(S,{})]})})});z.displayName=p.UC.displayName,a.forwardRef((e,t)=>{let{className:i,...a}=e;return(0,l.jsx)(p.JU,{ref:t,className:d("py-1.5 pl-8 pr-2 text-sm font-semibold",i),...a})}).displayName=p.JU.displayName;let k=a.forwardRef((e,t)=>{let{className:i,children:a,...s}=e;return(0,l.jsxs)(p.q7,{ref:t,className:d("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",i),...s,children:[(0,l.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,l.jsx)(p.VF,{children:(0,l.jsx)(b.A,{className:"h-4 w-4"})})}),(0,l.jsx)(p.p4,{children:a})]})});k.displayName=p.q7.displayName,a.forwardRef((e,t)=>{let{className:i,...a}=e;return(0,l.jsx)(p.wv,{ref:t,className:d("-mx-1 my-1 h-px bg-muted",i),...a})}).displayName=p.wv.displayName;var M=i(9515),C=i(689);let R=M.bL,L=M.l9,I=M.ZL;M.bm;let A=a.forwardRef((e,t)=>{let{className:i,...a}=e;return(0,l.jsx)(M.hJ,{ref:t,className:d("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",i),...a})});A.displayName=M.hJ.displayName;let U=a.forwardRef((e,t)=>{let{className:i,children:a,...s}=e;return(0,l.jsxs)(I,{children:[(0,l.jsx)(A,{}),(0,l.jsxs)(M.UC,{ref:t,className:d("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",i),...s,children:[a,(0,l.jsxs)(M.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,l.jsx)(C.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});U.displayName=M.UC.displayName;let E=e=>{let{className:t,...i}=e;return(0,l.jsx)("div",{className:d("flex flex-col space-y-1.5 text-center sm:text-left",t),...i})};E.displayName="DialogHeader";let T=e=>{let{className:t,...i}=e;return(0,l.jsx)("div",{className:d("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...i})};T.displayName="DialogFooter";let Y=a.forwardRef((e,t)=>{let{className:i,...a}=e;return(0,l.jsx)(M.hE,{ref:t,className:d("text-lg font-semibold leading-none tracking-tight",i),...a})});Y.displayName=M.hE.displayName,a.forwardRef((e,t)=>{let{className:i,...a}=e;return(0,l.jsx)(M.VY,{ref:t,className:d("text-sm text-muted-foreground",i),...a})}).displayName=M.VY.displayName;var P=i(6133),_=i(5686),B=i(3915),F=i(4801),O=i(4303),X=i(6426),D=i(4353);function W(){let[e,t]=(0,a.useState)({width:20,height:20,tileSize:32}),[i,s]=(0,a.useState)({width:20,height:20,tileSize:32}),[r,n]=(0,a.useState)({image:null,tileSize:32,columns:0,rows:0}),[o,d]=(0,a.useState)([{id:"layer-1",name:"Layer 1",visible:!0,tiles:[]}]),[c,h]=(0,a.useState)("layer-1"),[u,p]=(0,a.useState)(null),[g,y]=(0,a.useState)(null),[b,w]=(0,a.useState)("place"),[S,M]=(0,a.useState)([]),[C,I]=(0,a.useState)(-1),[A,W]=(0,a.useState)(!1),[J,V]=(0,a.useState)([]),[q,H]=(0,a.useState)(null),[K,Z]=(0,a.useState)(!1),Q=(0,a.useRef)(null),$=(0,a.useRef)(null),G=(0,a.useRef)(!1);(0,a.useEffect)(()=>{et()},[e,o]),(0,a.useEffect)(()=>{r.image&&ei()},[r]);let ee=()=>{if(0===J.length)return;let e={};d(o.map(t=>{let i=t.tiles.filter(e=>J.some(t=>t.x===e.x&&t.y===e.y));return i.length>0&&(e[t.id]=i),{...t,tiles:t.tiles.filter(e=>!J.some(t=>t.x===e.x&&t.y===e.y))}})),Object.entries(e).forEach(e=>{let[t,i]=e;en({type:"delete",layerId:t,tiles:i})}),V([])},et=()=>{let t=Q.current;if(!t)return;let i=t.getContext("2d");if(i){t.width=e.width*e.tileSize,t.height=e.height*e.tileSize,i.clearRect(0,0,t.width,t.height),i.strokeStyle="#ccc",i.lineWidth=1;for(let l=0;l<=e.width;l++)i.beginPath(),i.moveTo(l*e.tileSize,0),i.lineTo(l*e.tileSize,t.height),i.stroke();for(let l=0;l<=e.height;l++)i.beginPath(),i.moveTo(0,l*e.tileSize),i.lineTo(t.width,l*e.tileSize),i.stroke();if(r.image&&o.forEach(t=>{t.visible&&t.tiles.forEach(t=>{i.drawImage(r.image,t.tileX*r.tileSize,t.tileY*r.tileSize,r.tileSize,r.tileSize,t.x*e.tileSize,t.y*e.tileSize,e.tileSize,e.tileSize)})}),"select"===b&&J.length>0&&(i.strokeStyle="#ff0000",i.lineWidth=2,J.forEach(t=>{let{x:l,y:a}=t;i.strokeRect(l*e.tileSize,a*e.tileSize,e.tileSize,e.tileSize)})),"select"===b&&q&&G.current){let l=t.getBoundingClientRect(),a=Math.floor((event.clientX-l.left)/e.tileSize),s=Math.floor((event.clientY-l.top)/e.tileSize),r=Math.max(0,Math.min(q.x,a)),n=Math.max(0,Math.min(q.y,s)),o=Math.min(e.width-1,Math.max(q.x,a)),d=Math.min(e.height-1,Math.max(q.y,s));i.strokeStyle="rgba(0, 100, 255, 0.5)",i.lineWidth=2,i.strokeRect(r*e.tileSize,n*e.tileSize,(o-r+1)*e.tileSize,(d-n+1)*e.tileSize)}}},ei=()=>{let e=$.current;if(!e||!r.image)return;let t=e.getContext("2d");if(t){e.width=r.image.width,e.height=r.image.height,t.drawImage(r.image,0,0),t.strokeStyle="#ccc",t.lineWidth=1;for(let e=0;e<r.columns;e++)for(let i=0;i<r.rows;i++)t.strokeRect(e*r.tileSize,i*r.tileSize,r.tileSize,r.tileSize);u&&(t.strokeStyle="#ff0000",t.lineWidth=2,t.strokeRect(u.x*r.tileSize,u.y*r.tileSize,r.tileSize,r.tileSize))}},el=t=>{let i=t.currentTarget.getBoundingClientRect(),l=Math.floor((t.clientX-i.left)/e.tileSize),a=Math.floor((t.clientY-i.top)/e.tileSize);if(!(l>=e.width)&&!(a>=e.height)){if("place"===b&&u)es(l,a);else if("erase"===b)er(l,a);else if("select"===b){let e=o.flatMap(e=>e.tiles.map(t=>({...t,layerName:e.name}))).find(e=>e.x===l&&e.y===a);K?e&&(J.some(e=>e.x===l&&e.y===a)?V(J.filter(e=>!(e.x===l&&e.y===a))):V([...J,{x:l,y:a,tile:e}])):V(e?[{x:l,y:a,tile:e}]:[]),et()}}},ea=()=>{G.current=!1,H(null)},es=(e,t)=>{if(!u)return;let i={x:e,y:t,tileX:u.x,tileY:u.y,layerId:c};d(o.map(l=>{if(l.id===c){let a=l.tiles.filter(i=>i.x!==e||i.y!==t);return{...l,tiles:[...a,i]}}return l})),en({type:"add",layerId:c,tiles:[i]})},er=(e,t)=>{d(o.map(i=>{if(i.id===c){let l=i.tiles.filter(i=>i.x===e&&i.y===t),a=i.tiles.filter(i=>i.x!==e||i.y!==t);return l.length>0&&en({type:"delete",layerId:c,tiles:l}),{...i,tiles:a}}return i}))},en=e=>{let t=[...S.slice(0,C+1),e];M(t),I(t.length-1)};return(0,l.jsxs)("div",{className:"flex flex-col h-screen",tabIndex:-1,onKeyDown:e=>{"Shift"===e.key?Z(!0):("Delete"===e.key||"Backspace"===e.key)&&ee()},onKeyUp:e=>{"Shift"===e.key&&Z(!1)},children:[(0,l.jsxs)("div",{className:"border-b p-4 flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)(R,{open:A,onOpenChange:W,children:[(0,l.jsx)(L,{asChild:!0,children:(0,l.jsx)(f,{variant:"outline",children:"New Map"})}),(0,l.jsxs)(U,{children:[(0,l.jsx)(E,{children:(0,l.jsx)(Y,{children:"Create New Map"})}),(0,l.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,l.jsxs)("div",{className:"grid gap-2",children:[(0,l.jsx)(x,{htmlFor:"width",children:"Map Width (tiles)"}),(0,l.jsx)(m,{id:"width",type:"number",value:i.width,onChange:e=>s({...i,width:Number.parseInt(e.target.value)})})]}),(0,l.jsxs)("div",{className:"grid gap-2",children:[(0,l.jsx)(x,{htmlFor:"height",children:"Map Height (tiles)"}),(0,l.jsx)(m,{id:"height",type:"number",value:i.height,onChange:e=>s({...i,height:Number.parseInt(e.target.value)})})]}),(0,l.jsxs)("div",{className:"grid gap-2",children:[(0,l.jsx)(x,{htmlFor:"tileSize",children:"Tile Size (pixels)"}),(0,l.jsx)(m,{id:"tileSize",type:"number",value:i.tileSize,onChange:e=>s({...i,tileSize:Number.parseInt(e.target.value)})})]})]}),(0,l.jsx)(T,{children:(0,l.jsx)(f,{onClick:()=>{t(i),W(!1)},children:"Create Map"})})]})]}),(0,l.jsx)(m,{type:"file",accept:"image/*",onChange:e=>{var t;let i=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!i)return;let l=new Image;l.onload=()=>{n({image:l,tileSize:32,columns:Math.floor(l.width/32),rows:Math.floor(l.height/32)})},l.src=URL.createObjectURL(i)},className:"max-w-[200px]"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(f,{variant:"ghost",size:"icon",onClick:()=>w("select"),className:"select"===b?"bg-accent":"",children:(0,l.jsx)(P.A,{className:"h-4 w-4"})}),(0,l.jsx)(f,{variant:"ghost",size:"icon",onClick:()=>w("place"),className:"place"===b?"bg-accent":"",children:(0,l.jsx)(_.A,{className:"h-4 w-4"})}),(0,l.jsx)(f,{variant:"ghost",size:"icon",onClick:()=>w("erase"),className:"erase"===b?"bg-accent":"",children:(0,l.jsx)(B.A,{className:"h-4 w-4"})}),(0,l.jsx)(f,{variant:"ghost",size:"icon",onClick:()=>{if(C<0)return;let e=S[C];d(o.map(t=>{if(t.id===e.layerId){if("add"===e.type)return{...t,tiles:t.tiles.filter(t=>!e.tiles.includes(t))};if("delete"===e.type)return{...t,tiles:[...t.tiles,...e.tiles]}}return t})),I(C-1)},disabled:C<0,children:(0,l.jsx)(F.A,{className:"h-4 w-4"})}),(0,l.jsx)(f,{variant:"ghost",size:"icon",onClick:()=>{if(C>=S.length-1)return;let e=S[C+1];d(o.map(t=>{if(t.id===e.layerId){if("add"===e.type)return{...t,tiles:[...t.tiles,...e.tiles]};if("delete"===e.type)return{...t,tiles:t.tiles.filter(t=>!e.tiles.includes(t))}}return t})),I(C+1)},disabled:C>=S.length-1,children:(0,l.jsx)(O.A,{className:"h-4 w-4"})}),(0,l.jsx)(f,{variant:"ghost",size:"icon",onClick:()=>{let t=new Blob([JSON.stringify({config:e,layers:o},null,2)],{type:"application/json"}),i=URL.createObjectURL(t),l=document.createElement("a");l.href=i,l.download="tilemap.json",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i)},children:(0,l.jsx)(X.A,{className:"h-4 w-4"})})]})]}),(0,l.jsxs)("div",{className:"flex-1 flex",children:[(0,l.jsxs)("div",{className:"w-64 border-r p-4 flex flex-col gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h3",{className:"font-semibold",children:"Layers"}),(0,l.jsx)(f,{variant:"ghost",size:"icon",onClick:()=>{let e="layer-".concat(o.length+1);d([...o,{id:e,name:"Layer ".concat(o.length+1),visible:!0,tiles:[]}]),h(e)},children:(0,l.jsx)(D.A,{className:"h-4 w-4"})})]}),(0,l.jsxs)(j,{value:c,onValueChange:h,children:[(0,l.jsx)(N,{children:(0,l.jsx)(v,{})}),(0,l.jsx)(z,{children:o.map(e=>(0,l.jsx)(k,{value:e.id,children:e.name},e.id))})]}),r.image&&(0,l.jsx)("div",{className:"border rounded-lg p-2",children:(0,l.jsx)("canvas",{ref:$,onClick:e=>{let t=e.currentTarget.getBoundingClientRect();p({x:Math.floor((e.clientX-t.left)/r.tileSize),y:Math.floor((e.clientY-t.top)/r.tileSize)}),ei()},className:"w-full cursor-pointer",style:{imageRendering:"pixelated"}})}),J.length>0&&(0,l.jsxs)("div",{className:"border rounded-lg p-2",children:[(0,l.jsx)("h4",{className:"font-medium mb-2",children:"Selection Info"}),(0,l.jsxs)("p",{className:"text-sm",children:["Selected tiles: ",J.length]}),(0,l.jsxs)("p",{className:"text-sm",children:["Layers: ",Array.from(new Set(J.map(e=>e.tile.layerName))).join(", ")]}),1===J.length&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("p",{className:"text-sm",children:["Position: (",J[0].x,", ",J[0].y,")"]}),(0,l.jsxs)("p",{className:"text-sm",children:["Layer: ",J[0].tile.layerName]})]}),(0,l.jsx)(f,{className:"w-full mt-2",variant:"destructive",size:"sm",onClick:ee,children:"Delete Selected"})]})]}),(0,l.jsx)("div",{className:"flex-1 p-4 overflow-auto",children:(0,l.jsx)("canvas",{ref:Q,onClick:el,onMouseDown:t=>{if("select"===b){let i=t.currentTarget.getBoundingClientRect();H({x:Math.floor((t.clientX-i.left)/e.tileSize),y:Math.floor((t.clientY-i.top)/e.tileSize)}),G.current=!0,K||V([])}else G.current=!0,el(t)},onMouseUp:ea,onMouseLeave:ea,onMouseMove:t=>{if(!G.current||"select"!==b||!q)return;let i=t.currentTarget.getBoundingClientRect(),l=Math.floor((t.clientX-i.left)/e.tileSize),a=Math.floor((t.clientY-i.top)/e.tileSize),s=Math.max(0,Math.min(q.x,l)),r=Math.max(0,Math.min(q.y,a)),n=Math.min(e.width-1,Math.max(q.x,l)),d=Math.min(e.height-1,Math.max(q.y,a)),c=[];for(let e=s;e<=n;e++)for(let t=r;t<=d;t++){let i=o.flatMap(e=>e.tiles.map(t=>({...t,layerName:e.name}))).find(i=>i.x===e&&i.y===t);i&&c.push({x:e,y:t,tile:i})}V(e=>K?[...e.filter(e=>!c.some(t=>t.x===e.x&&t.y===e.y)),...c]:c),et()},className:"border rounded-lg",style:{imageRendering:"pixelated"}})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[163,441,517,358],()=>t(1661)),_N_E=e.O()}]);